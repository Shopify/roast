# typed: true
# frozen_string_literal: true

#: self as Roast::DSL::Workflow

config do
  cmd(:echo) { display! }
  cmd(/date/) { display! }
end

execute do
  # Anonymous cog. Added to the stack directly and given an autogenerated key in cog storage
  # Use for actions you do once and forget about, don't need configuration
  cmd { |my| my.command = "touch tmp/#{SecureRandom.uuid}" }

  # Named cog. Configuration for this specific instance will be looked up from config block
  cmd(:echo) { |my| my.command = "echo 'Hello World!'" }

  # Cogs can implement input coercion for simple return values
  fmt = "\"+%a %b %d %T %Z %Y\""
  cmd(:date_today) { "/bin/date #{fmt}" }
  cmd(:date_yesterday) { RUBY_PLATFORM.include?("darwin") ? "/bin/date -jv -1d #{fmt}" : "/bin/date -d '-1 day' #{fmt}" }
end
