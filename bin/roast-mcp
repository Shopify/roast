#!/usr/bin/env ruby
# frozen_string_literal: true

# MCP Server wrapper for Roast
# This ensures a clean environment for the MCP protocol

# Set up load path
$LOAD_PATH.unshift(File.expand_path("../lib", __dir__))

# Ensure UTF-8 encoding
Encoding.default_external = Encoding::UTF_8
Encoding.default_internal = Encoding::UTF_8

# Load dependencies
require "bundler/setup"
require "roast/commands/mcp_server"

# Get workflow directories from arguments
workflow_dirs = ARGV

# Create and run the server
begin
  server = Roast::Commands::MCPServer.new(workflow_dirs: workflow_dirs)
  server.run
rescue StandardError => e
  # Log errors to stderr
  $stderr.puts "MCP Server Error: #{e.message}"
  $stderr.puts e.backtrace.join("\n")
  exit 1
end